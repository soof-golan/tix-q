---
import WaitingRoom from "../../components/WaitingRoom";
import { PrismaClient } from "@prisma/client";
import {
  InferGetStaticParamsType,
  InferGetStaticPropsType,
  GetStaticPaths,
} from "astro";

// Runs at build time
export const getStaticPaths = (async () => {
  const prisma = new PrismaClient();
  const rooms = await prisma.waitingRoom.findMany();
  return rooms.map((room) => ({
    props: room,
    params: { id: room.id },
  }));
}) satisfies GetStaticPaths;
type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { opensAt, closesAt, title, markdown } = Astro.props as Props;
const { id } = Astro.params as Params;
---

<html>
  <head>
    <title>{title}</title>
  </head>
  <body>
    <main>
      <h1>Waiting Room</h1>
      {markdown}
      <p>Opens at: {opensAt}</p>
      <p>Closes at: {closesAt}</p>
      <WaitingRoom
        waitingRoomId={id}
        opensAt={opensAt}
        closesAt={closesAt}
        client:load
      />
    </main>
  </body>
</html>

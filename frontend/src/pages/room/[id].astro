---
import Countdown from "react-countdown";
import Test from "../../components/InteractiveTest"
import {PrismaClient} from '@prisma/client';
import {InferGetStaticParamsType, InferGetStaticPropsType, GetStaticPaths} from 'astro';

// Runs at build time
export const getStaticPaths = (async () => {
  const prisma = new PrismaClient();
  const rooms = await prisma.waitingRoom.findMany();
    return rooms.map(room => ({
      props: room,
      params: {id: room.id}
  }));
}) satisfies GetStaticPaths;
type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const {
  opensAt,
  closesAt,
  title,
  content,
} = Astro.props as Props;
const {
  id
} = Astro.params as Params;
---
<html>
<head>
    <title>{title}</title>
</head>
<body>
<h1>Waiting Room</h1>
<p>{content}</p>
<p>Opens at: {opensAt}</p>
<p>Closes at: {closesAt}</p>
<Countdown date={opensAt} client:load >
  <p>Waiting room is open!</p>
  <p>Imagine there's a form here + Turnstile component</p>
</Countdown>
<Test client:load/>
</body>
</html>

